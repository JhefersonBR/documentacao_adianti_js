<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>componentes/tfieldlist/tfieldlist.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-Global.html">Global</a><ul class='methods'><li data-type='method'><a href="module-Global.html#~__adianti_ajax_exec">__adianti_ajax_exec</a></li><li data-type='method'><a href="module-Global.html#~__adianti_ajax_lookup">__adianti_ajax_lookup</a></li><li data-type='method'><a href="module-Global.html#~__adianti_append_page">__adianti_append_page</a></li><li data-type='method'><a href="module-Global.html#~__adianti_base_url">__adianti_base_url</a></li><li data-type='method'><a href="module-Global.html#~__adianti_block_ui">__adianti_block_ui</a></li><li data-type='method'><a href="module-Global.html#~__adianti_can_open_iframe">__adianti_can_open_iframe</a></li><li data-type='method'><a href="module-Global.html#~__adianti_clear_tabs">__adianti_clear_tabs</a></li><li data-type='method'><a href="module-Global.html#~__adianti_create_tab_item">__adianti_create_tab_item</a></li><li data-type='method'><a href="module-Global.html#~__adianti_debounce">__adianti_debounce</a></li><li data-type='method'><a href="module-Global.html#~__adianti_dialog">__adianti_dialog</a></li><li data-type='method'><a href="module-Global.html#~__adianti_download_file">__adianti_download_file</a></li><li data-type='method'><a href="module-Global.html#~__adianti_error">__adianti_error</a></li><li data-type='method'><a href="module-Global.html#~__adianti_failure_request">__adianti_failure_request</a></li><li data-type='method'><a href="module-Global.html#~__adianti_get_page">__adianti_get_page</a></li><li data-type='method'><a href="module-Global.html#~__adianti_goto_page">__adianti_goto_page</a></li><li data-type='method'><a href="module-Global.html#~__adianti_init_tabs">__adianti_init_tabs</a></li><li data-type='method'><a href="module-Global.html#~__adianti_input">__adianti_input</a></li><li data-type='method'><a href="module-Global.html#~__adianti_load_html">__adianti_load_html</a></li><li data-type='method'><a href="module-Global.html#~__adianti_load_page">__adianti_load_page</a></li><li data-type='method'><a href="module-Global.html#~__adianti_load_tab">__adianti_load_tab</a></li><li data-type='method'><a href="module-Global.html#~__adianti_message">__adianti_message</a></li><li data-type='method'><a href="module-Global.html#~__adianti_open_page">__adianti_open_page</a></li><li data-type='method'><a href="module-Global.html#~__adianti_parse_html">__adianti_parse_html</a></li><li data-type='method'><a href="module-Global.html#~__adianti_post_data">__adianti_post_data</a></li><li data-type='method'><a href="module-Global.html#~__adianti_process_popover">__adianti_process_popover</a></li><li data-type='method'><a href="module-Global.html#~__adianti_query_string">__adianti_query_string</a></li><li data-type='method'><a href="module-Global.html#~__adianti_query_to_json">__adianti_query_to_json</a></li><li data-type='method'><a href="module-Global.html#~__adianti_question">__adianti_question</a></li><li data-type='method'><a href="module-Global.html#~__adianti_register_state">__adianti_register_state</a></li><li data-type='method'><a href="module-Global.html#~__adianti_scroll_tab">__adianti_scroll_tab</a></li><li data-type='method'><a href="module-Global.html#~__adianti_scroll_to_active_tab">__adianti_scroll_to_active_tab</a></li><li data-type='method'><a href="module-Global.html#~__adianti_set_active_iframe">__adianti_set_active_iframe</a></li><li data-type='method'><a href="module-Global.html#~__adianti_set_current_tab">__adianti_set_current_tab</a></li><li data-type='method'><a href="module-Global.html#~__adianti_set_debug">__adianti_set_debug</a></li><li data-type='method'><a href="module-Global.html#~__adianti_set_language">__adianti_set_language</a></li><li data-type='method'><a href="module-Global.html#~__adianti_set_name">__adianti_set_name</a></li><li data-type='method'><a href="module-Global.html#~__adianti_show_popover">__adianti_show_popover</a></li><li data-type='method'><a href="module-Global.html#~__adianti_store_tab_content">__adianti_store_tab_content</a></li><li data-type='method'><a href="module-Global.html#~__adianti_unblock_ui">__adianti_unblock_ui</a></li><li data-type='method'><a href="module-Global.html#~__adianti_warning">__adianti_warning</a></li><li data-type='method'><a href="module-Global.html#~__adianti_window">__adianti_window</a></li></ul></li><li><a href="module-TArrowStep.html">TArrowStep</a><ul class='methods'><li data-type='method'><a href="module-TArrowStep.html#~tarrowstep_disable_field">tarrowstep_disable_field</a></li><li data-type='method'><a href="module-TArrowStep.html#~tarrowstep_enable_field">tarrowstep_enable_field</a></li></ul></li><li><a href="module-TBarcodeInputReader.html">TBarcodeInputReader</a></li><li></li><li><a href="module-TButton.html">TButton</a></li><li><a href="module-TCheckGroup.html">TCheckGroup</a></li><li><a href="module-TColor.html">TColor</a></li><li><a href="module-TCombo.html">TCombo</a></li><li><a href="module-TDataGrid.html">TDataGrid</a></li><li><a href="module-TDate.html">TDate</a></li><li><a href="module-TDateTime.html">TDateTime</a></li><li><a href="module-TDbEntry.html">TDbEntry</a></li><li><a href="module-TDbMultiSearch.html">TDbMultiSearch</a></li><li><a href="module-TDbUniqueSearch.html">TDbUniqueSearch</a></li><li><a href="module-TDialog.html">TDialog</a></li><li><a href="module-TEntry.html">TEntry</a><ul class='methods'><li data-type='method'><a href="module-TEntry.html#~tentry_lower">tentry_lower</a></li><li data-type='method'><a href="module-TEntry.html#~tentry_mask">tentry_mask</a></li><li data-type='method'><a href="module-TEntry.html#~tentry_upper">tentry_upper</a></li></ul></li><li><a href="module-TExpander.html">TExpander</a></li><li><a href="module-TField.html">TField</a></li><li><a href="module-TFieldList.html">TFieldList</a></li><li><a href="module-TFile.html">TFile</a></li><li><a href="module-TForm.html">TForm</a></li><li><a href="module-TFullCalendar.html">TFullCalendar</a></li><li><a href="module-THtmlEditor.html">THtmlEditor</a></li><li><a href="module-TIcon.html">TIcon</a></li><li><a href="module-TImageCropper.html">TImageCropper</a></li><li><a href="module-TJQueryDialog.html">TJQueryDialog</a></li><li><a href="module-TKanban.html">TKanban</a></li><li><a href="module-TLabel.html">TLabel</a></li><li><a href="module-TMenuBar.html">TMenuBar</a></li><li><a href="module-TMultiEntry.html">TMultiEntry</a></li><li><a href="module-TMultiFile.html">TMultiFile</a><ul class='methods'><li data-type='method'><a href="module-TMultiFile.html#~MultiFileUploader">MultiFileUploader</a></li></ul></li><li></li><li><a href="module-TPassword.html">TPassword</a></li><li><a href="module-TQrCodeInputReader.html">TQrCodeInputReader</a></li><li><a href="module-TRadioGroup.html">TRadioGroup</a></li><li><a href="module-TSeekButton.html">TSeekButton</a></li><li><a href="module-TSelect.html">TSelect</a></li><li><a href="module-TSlider.html">TSlider</a></li><li><a href="module-TSortList.html">TSortList</a></li><li><a href="module-TSpinner.html">TSpinner</a></li><li><a href="module-TTable.html">TTable</a></li><li><a href="module-TTreeView.html">TTreeView</a></li><li><a href="module-TiconView.html">TiconView</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">componentes/tfieldlist/tfieldlist.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/** @module TFieldList */

function tfieldlist_reset_fields(row, clear_fields)
{
    var uniqid = parseInt(Math.random() * 100000000);
    $(row).attr('id', uniqid);
    var fields = $(row).find('input,select');
    var newids = [];
    
    $.each(fields, function(index, field)
    {
        var field_id = $(field).attr('id');
        var field_component = $(field).attr('widget');
        var field_role = $(field).attr('role');
        
        if (typeof field_id !== "undefined")
        {
            var field_id_parts = field_id.split('_');
            field_id_parts.pop();
            var field_prefix = field_id_parts.join('_');
            var new_id = field_prefix + '_' + uniqid;
            var parent = $(field).parent();
            
            if (newids.indexOf(new_id) >= 0 )
            {
                var new_id = field_prefix + parseInt(Math.random() * 100) + '_' + uniqid;
            }
            newids.push(new_id);
            
            if (field_component == 'tdate' || field_component == 'ttime' || field_component == 'tdatetime')
            {
                // realocate in dom
                $(field).attr('id', new_id);
                if (clear_fields) {
                    $(field).val('');
                }
                
                if (typeof $(field).attr('exitaction') !== 'undefined') {
                    $(field).attr('exitaction', $(field).attr('exitaction').replace(field_id, new_id));
                }
                if (typeof $(field).attr('onblur') !== 'undefined') {
                    $(field).attr('onblur', $(field).attr('onblur').replace(field_id, new_id));
                }
                
                grandparent = $(parent).parent();
                field = $(field).detach()
                $(parent).remove();
                grandparent.append(field);
                
                var script_filter = field_component;
                if (field_component == 'ttime') {
                  var script_filter = 'tdatetime';
                }
                
                var re = new RegExp(field_id, 'g');
                tfieldlist_execute_scripts(grandparent, script_filter, function(script_content) {
                    script_content = script_content.replace(re, new_id);
                    return script_content;
                });
            }
            else if (field_component =='tentry')
            {
                $(field).attr('id', new_id);
                if (clear_fields) {
                    $(field).val('');
                }
                
                if (typeof $(field).attr('exitaction') !== 'undefined') {
                    $(field).attr('exitaction', $(field).attr('exitaction').replace(field_id, new_id));
                }
                if (typeof $(field).attr('onblur') !== 'undefined') {
                    $(field).attr('onblur', $(field).attr('onblur').replace(field_id, new_id));
                }
                
                var re = new RegExp(field_id, 'g');
                tfieldlist_execute_scripts(parent, 'tentry', function(script_content) {
                    script_content = script_content.replace(re, new_id);
                    return script_content;
                });
            }
            else if (field_component =='tspinner')
            {
                $(field).attr('id', new_id);
                if (clear_fields) {
                    $(field).val('');
                }
                
                if (typeof $(field).attr('exitaction') !== 'undefined') {
                    $(field).attr('exitaction', $(field).attr('exitaction').replace(field_id, new_id));
                }
                if (typeof $(field).attr('onblur') !== 'undefined') {
                    $(field).attr('onblur', $(field).attr('onblur').replace(field_id, new_id));
                }
                
                grandparent = $(parent).parent();
                field = $(field).detach()
                $(parent).remove();
                grandparent.append(field);
                
                var re = new RegExp(field_id, 'g');
                tfieldlist_execute_scripts(grandparent, 'tspinner', function(script_content) {
                    script_content = script_content.replace(re, new_id);
                    return script_content;
                });
            }
            else if (field_component =='tcolor')
            {
                // realocate in dom
                $(field).attr('id', new_id);
                if (clear_fields) {
                    $(field).val('');
                }
                
                if (typeof $(field).attr('exitaction') !== 'undefined') {
                    $(field).attr('exitaction', $(field).attr('exitaction').replace(field_id, new_id));
                }
                if (typeof $(field).attr('onblur') !== 'undefined') {
                    $(field).attr('onblur', $(field).attr('onblur').replace(field_id, new_id));
                }
                
                grandparent = $(parent).parent();
                
                var re = new RegExp(field_id, 'g');
                tfieldlist_execute_scripts(grandparent, 'tcolor', function(script_content) {
                    script_content = script_content.replace(re, new_id);
                    return script_content;
                });
            }
            else if (field_component =='thidden')
            {
                $(field).attr('id', new_id);
                if ($(field).attr('uniqid') == 'true') {
                    $(field).val(parseInt(Math.random() * 10000000000));
                }
                else if (clear_fields) {
                    $(field).val('');
                }
                
                var re = new RegExp(field_id, 'g');
                tfieldlist_execute_scripts(parent, 'thidden', function(script_content) {
                    script_content = script_content.replace(re, new_id);
                    return script_content;
                });
            }
            else if (field_component =='tdbmultisearch' || field_component =='tdbuniquesearch')
            {
                $(field).attr('id', new_id);
                $(field).removeData('select2-id').removeAttr('data-select2-id').find('option').removeAttr('data-select2-id');
                $(row).removeData('select2-id').removeAttr('data-select2-id');
                
                // remove select2 container previously processed
                $(parent).find('.select2-container').remove();
                
                var re = new RegExp(field_id, 'g');
                tfieldlist_execute_scripts(parent, 'tdbmultisearch', function(script_content) {
                    script_content = script_content.replace(re, new_id);
                    return script_content;
                });
                
                if (clear_fields) {
                    setTimeout(function() { $(field).val('').trigger('change.select2'); }, 10 );
                }
            }
            else if (field_component =='tmultisearch' || field_component =='tuniquesearch')
            {
                $(field).attr('id', new_id);
                $(field).removeData('select2-id').removeAttr('data-select2-id').find('option').removeAttr('data-select2-id');
                $(row).removeData('select2-id').removeAttr('data-select2-id');
                
                $(parent).find('.select2-container').remove();
                
                var re = new RegExp(field_id, 'g');
                tfieldlist_execute_scripts(parent, 'tmultisearch', function(script_content) {
                    script_content = script_content.replace(re, new_id);
                    return script_content;
                });
                
                if (clear_fields) {
                    setTimeout(function() { $(field).val('').trigger('change.select2'); }, 10 );
                }
            }
            else if (field_component =='tcombo')
            {
                $(field).attr('id', new_id);
                
                if (clear_fields) {
                    $(field).val('');
                }
                if (field_role == 'tcombosearch') {
                    // clear data attributes
                    $(field).removeData('select2-id').removeAttr('data-select2-id').find('option').removeAttr('data-select2-id');
                    $(row).removeData('select2-id').removeAttr('data-select2-id');
                    $(parent).find('.select2-container').remove();
                }
                
                if (typeof $(field).attr('changeaction') !== 'undefined') {
                    $(field).attr('changeaction', $(field).attr('changeaction').replace(field_id, new_id));
                }
                if (typeof $(field).attr('onchange') !== 'undefined') {
                    $(field).attr('onchange', $(field).attr('onchange').replace(field_id, new_id));
                }
                
                var re = new RegExp(field_id, 'g');
                tfieldlist_execute_scripts(parent, 'tcombo', function(script_content) {
                    script_content = script_content.replace(re, new_id);
                    return script_content;
                });
            }
            else if (field_component =='tfile')
            {
                $(field).attr('id', new_id);
                
                if (clear_fields) {
                    $(field).val('');
                }
                
                var parent = $(field).closest('td');
                var file_wrapper_id = parent.find('.div_file').attr('id');
                var new_file_wrapper_id = 'div_file_' + uniqid;
                
                parent.find('.tfile_row_wrapper').remove();
                parent.find('.file-response-icon').remove();
                parent.find('.div_file').attr('id', new_file_wrapper_id);
                $(field).css('padding-left', '5px');
                
                if (typeof $(field).attr('changeaction') !== 'undefined') {
                    $(field).attr('changeaction', $(field).attr('changeaction').replace(field_id, new_id));
                }
                if (typeof $(field).attr('onchange') !== 'undefined') {
                    $(field).attr('onchange', $(field).attr('onchange').replace(field_id, new_id));
                }
                
                var re  = new RegExp(field_id, 'g');
                var re2 = new RegExp(file_wrapper_id, 'g');
                tfieldlist_execute_scripts(parent, 'tfile', function(script_content) {
                    script_content = script_content.replace(re,  new_id);
                    script_content = script_content.replace(re2, new_file_wrapper_id);
                    return script_content;
                });
            }
        }
        
        // fora do if pois não troca ID (não possui ID), só reinicia value
        if (field_component =='tradiobutton')
        {
            $(field).parent().removeClass('active');
        }
        else if (field_component =='tcheckbutton')
        {
            $(field).parent().removeClass('active');
        }
    });
}

function tfieldlist_execute_scripts(container, filter, callback)
{
    var scripts = $(container).find('script');
    $.each(scripts, function(sindex, script)
    {
        var text = $(script).text();
        text = callback(text);
        if (text.trim().split('_')[0] == filter) {
            //$(script).text(text);
            //setTimeout(function() {new Function(text)(); }, 10 );
            $(script).html('&lt;script>'+text+'&lt;/script>');
        }
    });
}

function tfieldlist_clear(name)
{
    ttable_clone_previous_row( $('[name='+name+'] tbody') );
    var rows = $('[name='+name+'] tbody').find('tr').length - 1;
    $('[name='+name+'] tbody').find('tr').each(function(i,e){
        if(i&lt;rows) {
            ttable_remove_row(e);
        }
    });
    $('[name='+name+'] tfoot').find('input[type="text"]').each(function(i,e){
        tfieldlist_update_sum(name, $(e).attr('field_name'));
    });
}

function tfieldlist_add_rows(name, rows, timeout)
{
    timeout = timeout ? timeout : 50;

    for (n=1; n&lt;=rows; n++)
    {
        setTimeout(function() {
            ttable_clone_previous_row( $('[name='+name+'] tbody') );
        }, timeout * n);
    }
}

function tfieldlist_clear_rows(name, start, length)
{
    var rows = $('[name='+name+'] tbody').find('tr').length;
    length = ( (length == 0) ? rows : length ) + start;
    if(length>=rows)
    {
        ttable_clone_previous_row( $('[name='+name+'] tbody').find('tr:last') );
        length = rows;
    }

    $('[name='+name+'] tbody').find('tr').each(function(i,e){
        if(i>=start &amp;&amp; i&lt;length){
            $(e).remove();
        }
    });
}

function tfieldlist_get_last_row_data(generator)
{
    var values = {};
    values.index = $(generator).closest('table').find('tbody tr:last').index();
    
    $(generator).closest('table').find('tbody tr:last').find('[name]').each(function(k,v) {
        var attribute_name  = $(v).attr('name');
        attribute_name = attribute_name.replace('[]', '');
        values[ attribute_name ] = $(v).val();
    });
    
    return values;
}

function tfieldlist_get_row_data(generator)
{
    var values = {};
    values.index = $(generator).closest('tr').index();
    
    values[ '_row_id' ] = $(generator).closest('tr').attr('id');
    
    $(generator).closest('tr').find('[name]').each(function(k,v) {
        var attribute_name  = $(v).attr('name');
        attribute_name = attribute_name.replace('[]', '');
        values[ attribute_name ] = $(v).val();
    });
    
    return values;
}

function tfieldlist_column_sum(field_name)
{
    var total = 0;
    $('[name="'+field_name+'[]"]').each(function (k,v) {
        var total_raw = tentry_get_data_by_id( $(v).attr('id') );
        if (!isNaN(parseFloat(total_raw))) {
            total += parseFloat(total_raw);
        }
    });
    return total;
}

function tfieldlist_update_sum(fieldlist_name, field_name, callback)
{
    setTimeout( function() {
        var total = tfieldlist_column_sum(field_name);
        var mask  = $('[name^='+field_name+']:first').data('nmask');
        var maskParts = [];
        
        if (mask) {
            maskParts = mask.split('');
        }
        
        $('[name=grandtotal_'+field_name+']').val( number_format( total, maskParts[0]??2, maskParts[1]??',', maskParts[2]??'.') );
        
        if (callback &amp;&amp; typeof(callback) === "function")
        {
            callback();
        }
        
        var total_update_action = $('table[name='+fieldlist_name+']').attr('total-update-action');
        
        if (typeof total_update_action !== 'undefined' &amp;&amp; total_update_action.length > 0)
        {
            var parent_form = $('table[name='+fieldlist_name+']').closest('form');
    		
    		if (parent_form) {
                var data = {};
                var final_results = {};
                
                var form_data = $(parent_form).serializeArray();
                
                $(form_data ).each(function(index, obj) {
                    var column_name = obj.name;
                    var column_name = column_name.replace('[]', '');
                    
                    if(data[column_name] === undefined) {
                        data[column_name] = [];
                    }
                    
                    data[column_name].push(obj.value);
                });
                
                for (prop in data) {
                    if (data[prop].length > 1) {
                        for (var i = 0; i &lt; data[prop].length; i++) {
                            if (typeof final_results[i] == 'undefined') {
                                final_results[i] = {};
                            }
                            final_results[i][prop] = data[prop][i]
                        }
                    }
                }
                
                data['list_data'] = final_results;
    		}
    		
    		__adianti_post_exec(total_update_action, data, null, '1', true);
        }
    }, 50);
}
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.2</a> on Mon Aug 21 2023 12:34:09 GMT-0300 (Horário Padrão de Brasília) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>



</body>
</html>
