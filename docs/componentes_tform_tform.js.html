<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>componentes/tform/tform.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-Global.html">Global</a><ul class='methods'><li data-type='method'><a href="module-Global.html#~__adianti_ajax_exec">__adianti_ajax_exec</a></li><li data-type='method'><a href="module-Global.html#~__adianti_ajax_lookup">__adianti_ajax_lookup</a></li><li data-type='method'><a href="module-Global.html#~__adianti_append_page">__adianti_append_page</a></li><li data-type='method'><a href="module-Global.html#~__adianti_base_url">__adianti_base_url</a></li><li data-type='method'><a href="module-Global.html#~__adianti_block_ui">__adianti_block_ui</a></li><li data-type='method'><a href="module-Global.html#~__adianti_can_open_iframe">__adianti_can_open_iframe</a></li><li data-type='method'><a href="module-Global.html#~__adianti_clear_tabs">__adianti_clear_tabs</a></li><li data-type='method'><a href="module-Global.html#~__adianti_create_tab_item">__adianti_create_tab_item</a></li><li data-type='method'><a href="module-Global.html#~__adianti_debounce">__adianti_debounce</a></li><li data-type='method'><a href="module-Global.html#~__adianti_dialog">__adianti_dialog</a></li><li data-type='method'><a href="module-Global.html#~__adianti_download_file">__adianti_download_file</a></li><li data-type='method'><a href="module-Global.html#~__adianti_error">__adianti_error</a></li><li data-type='method'><a href="module-Global.html#~__adianti_failure_request">__adianti_failure_request</a></li><li data-type='method'><a href="module-Global.html#~__adianti_get_page">__adianti_get_page</a></li><li data-type='method'><a href="module-Global.html#~__adianti_goto_page">__adianti_goto_page</a></li><li data-type='method'><a href="module-Global.html#~__adianti_init_tabs">__adianti_init_tabs</a></li><li data-type='method'><a href="module-Global.html#~__adianti_input">__adianti_input</a></li><li data-type='method'><a href="module-Global.html#~__adianti_load_html">__adianti_load_html</a></li><li data-type='method'><a href="module-Global.html#~__adianti_load_page">__adianti_load_page</a></li><li data-type='method'><a href="module-Global.html#~__adianti_load_tab">__adianti_load_tab</a></li><li data-type='method'><a href="module-Global.html#~__adianti_message">__adianti_message</a></li><li data-type='method'><a href="module-Global.html#~__adianti_open_page">__adianti_open_page</a></li><li data-type='method'><a href="module-Global.html#~__adianti_parse_html">__adianti_parse_html</a></li><li data-type='method'><a href="module-Global.html#~__adianti_post_data">__adianti_post_data</a></li><li data-type='method'><a href="module-Global.html#~__adianti_process_popover">__adianti_process_popover</a></li><li data-type='method'><a href="module-Global.html#~__adianti_query_string">__adianti_query_string</a></li><li data-type='method'><a href="module-Global.html#~__adianti_query_to_json">__adianti_query_to_json</a></li><li data-type='method'><a href="module-Global.html#~__adianti_question">__adianti_question</a></li><li data-type='method'><a href="module-Global.html#~__adianti_register_state">__adianti_register_state</a></li><li data-type='method'><a href="module-Global.html#~__adianti_scroll_tab">__adianti_scroll_tab</a></li><li data-type='method'><a href="module-Global.html#~__adianti_scroll_to_active_tab">__adianti_scroll_to_active_tab</a></li><li data-type='method'><a href="module-Global.html#~__adianti_set_active_iframe">__adianti_set_active_iframe</a></li><li data-type='method'><a href="module-Global.html#~__adianti_set_current_tab">__adianti_set_current_tab</a></li><li data-type='method'><a href="module-Global.html#~__adianti_set_debug">__adianti_set_debug</a></li><li data-type='method'><a href="module-Global.html#~__adianti_set_language">__adianti_set_language</a></li><li data-type='method'><a href="module-Global.html#~__adianti_set_name">__adianti_set_name</a></li><li data-type='method'><a href="module-Global.html#~__adianti_show_popover">__adianti_show_popover</a></li><li data-type='method'><a href="module-Global.html#~__adianti_store_tab_content">__adianti_store_tab_content</a></li><li data-type='method'><a href="module-Global.html#~__adianti_unblock_ui">__adianti_unblock_ui</a></li><li data-type='method'><a href="module-Global.html#~__adianti_warning">__adianti_warning</a></li><li data-type='method'><a href="module-Global.html#~__adianti_window">__adianti_window</a></li></ul></li><li><a href="module-TArrowStep.html">TArrowStep</a><ul class='methods'><li data-type='method'><a href="module-TArrowStep.html#~tarrowstep_disable_field">tarrowstep_disable_field</a></li><li data-type='method'><a href="module-TArrowStep.html#~tarrowstep_enable_field">tarrowstep_enable_field</a></li></ul></li><li><a href="module-TBarcodeInputReader.html">TBarcodeInputReader</a></li><li></li><li><a href="module-TButton.html">TButton</a></li><li><a href="module-TCheckGroup.html">TCheckGroup</a></li><li><a href="module-TColor.html">TColor</a></li><li><a href="module-TCombo.html">TCombo</a></li><li><a href="module-TDataGrid.html">TDataGrid</a></li><li><a href="module-TDate.html">TDate</a></li><li><a href="module-TDateTime.html">TDateTime</a></li><li><a href="module-TDbEntry.html">TDbEntry</a></li><li><a href="module-TDbMultiSearch.html">TDbMultiSearch</a></li><li><a href="module-TDbUniqueSearch.html">TDbUniqueSearch</a></li><li><a href="module-TDialog.html">TDialog</a></li><li><a href="module-TEntry.html">TEntry</a><ul class='methods'><li data-type='method'><a href="module-TEntry.html#~tentry_lower">tentry_lower</a></li><li data-type='method'><a href="module-TEntry.html#~tentry_mask">tentry_mask</a></li><li data-type='method'><a href="module-TEntry.html#~tentry_upper">tentry_upper</a></li></ul></li><li><a href="module-TExpander.html">TExpander</a></li><li><a href="module-TField.html">TField</a></li><li><a href="module-TFieldList.html">TFieldList</a></li><li><a href="module-TFile.html">TFile</a></li><li><a href="module-TForm.html">TForm</a></li><li><a href="module-TFullCalendar.html">TFullCalendar</a></li><li><a href="module-THtmlEditor.html">THtmlEditor</a></li><li><a href="module-TIcon.html">TIcon</a></li><li><a href="module-TImageCropper.html">TImageCropper</a></li><li><a href="module-TJQueryDialog.html">TJQueryDialog</a></li><li><a href="module-TKanban.html">TKanban</a></li><li><a href="module-TLabel.html">TLabel</a></li><li><a href="module-TMenuBar.html">TMenuBar</a></li><li><a href="module-TMultiEntry.html">TMultiEntry</a></li><li><a href="module-TMultiFile.html">TMultiFile</a><ul class='methods'><li data-type='method'><a href="module-TMultiFile.html#~MultiFileUploader">MultiFileUploader</a></li></ul></li><li></li><li><a href="module-TPassword.html">TPassword</a></li><li><a href="module-TQrCodeInputReader.html">TQrCodeInputReader</a></li><li><a href="module-TRadioGroup.html">TRadioGroup</a></li><li><a href="module-TSeekButton.html">TSeekButton</a></li><li><a href="module-TSelect.html">TSelect</a></li><li><a href="module-TSlider.html">TSlider</a></li><li><a href="module-TSortList.html">TSortList</a></li><li><a href="module-TSpinner.html">TSpinner</a></li><li><a href="module-TTable.html">TTable</a></li><li><a href="module-TTreeView.html">TTreeView</a></li><li><a href="module-TiconView.html">TiconView</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">componentes/tform/tform.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/** @module TForm */

function tform_send_data(form_name, field, value, fire_events, timeout)
{
    if (parseInt(timeout) > 0)
    {
        setTimeout( function() {
            tform_send_data(form_name, field, value, fire_events, 0);
        }, timeout);
        return;
    }

    try {
        if (field.substr(0,1) == '#')
        {
            var single_field = $(field);
            var array_field  = [];
            var multifile_field  = [];
        }
        else
        {
            var single_field    = $("form[name="+form_name+"] [name='"+field+"']");
            var array_field     = $("form[name="+form_name+"] [name='"+field+"[]']");
            var multifile_field = $("form[name="+form_name+"] [widget='tmultifile'][name='file_"+field+"[]']");
        }
        
        if (single_field.length || array_field.length || multifile_field) {
            if (typeof Adianti.formEventsCounter == 'undefined' || Number.isNaN(Adianti.formEventsCounter)) {
                Adianti.formEventsCounter = 0;
            }
            
            if (Adianti.formEventsCounter == 0 ) {
                if(multifile_field.length) {
                    try {
                        multifile_field[0].tmultifile.send_data(JSON.parse(value));
                    } 
                    catch (e) {
                        multifile_field[0].tmultifile.setValue(value);
                    }
                }
                else if (single_field.length) {
                    
                    if (single_field.attr('widget') == 'thtmleditor') {
                        single_field.summernote( "code", value );
                    }
                    else if (single_field.attr('widget') == 'tcolor') {
                        single_field.colorpicker('setValue', value);
                    }
                    else if (single_field.attr('widget') == 'tarrowstep') {
                        tarrowstep_set_current(single_field[0].name, value);
                    }
                    else if (single_field.attr('widget') == 'tdate') {
                        tdate_set_value('#'+single_field.attr('id'), value);
                    }
                    else if (single_field.attr('widget') == 'timagecropper') {
                        single_field[0].timagecropper.setValue(value);
                    }
                    else if (single_field.attr('widget') == 'tfile') {
                        single_field[0].tfile.setValue(value);
                    }
                    else if (single_field.attr('role') == 'tcombosearch') {
                        // only when is different to avoid extra asynchronous event calls on hierarchical combos
                        if (single_field.val() !== value) {
                            var select2_template = function (d) {
                                if (/&lt;[a-z][\s\S]*>/i.test(d.text)) {
                                    return $("&lt;span>"+d.text+"&lt;/span>");
                                }
                                else {
                                    return d.text;
                                }
                            };
                            
                            single_field.select2({templateResult: select2_template, templateSelection: select2_template}).val(value).trigger('change.select2');
                        }
                    }
                    else if (single_field.attr('widget') == 'tdbuniquesearch') {
                        var tdbunique_fire_events = fire_events;
                        tdbuniquesearch_set_value(form_name, field, value, function() {
                            // fire events must be after fetch elements from service
                            if (tdbunique_fire_events) {
                                if (single_field.attr('exitaction')) {
                                    tform_events_hang_exec( single_field.attr('exitaction') );
                                }
                                if (single_field.attr('changeaction')) {
                                    tform_events_hang_exec( single_field.attr('changeaction') );
                                }
                            }
                        });
                        // fire events is called within callback
                        fire_events = false;
                    }
                    else if (single_field.attr('component') == 'multisearch') {
                        if (value) {
                        
                            var select2_template = function (d) {
                                if (/&lt;[a-z][\s\S]*>/i.test(d.text)) {
                                    return $("&lt;span>"+d.text+"&lt;/span>");
                                }
                                else {
                                    return d.text;
                                }
                            };
                            
                            single_field.select2({templateResult: select2_template, templateSelection: select2_template}).val(value).trigger('change.select2');
                        }
                    }
                    // checkbox is tested here when used alone inside a form (no checkgroup)
                    else if (single_field.attr('type') == 'radio' || single_field.attr('type') == 'checkbox') {
                        if (value) {
                            var radio_input = single_field.filter('[value="'+value+'"]').prop('checked', true);
                            if (radio_input.parent().prop('tagName') == 'LABEL') {
                                radio_input.parent().parent().find('label').removeClass('active');
                                radio_input.parent().toggleClass('active');
                            }
                        }
                    }
                    else {
                        single_field.val( value );
                    }
                    
                    if (fire_events) { 
                        if (single_field.attr('exitaction')) {
                            tform_events_hang_exec( single_field.attr('exitaction') );
                        }
                        if (single_field.attr('changeaction')) {
                            tform_events_hang_exec( single_field.attr('changeaction') );
                        }
                    }
                }
                else if (array_field.length)
                {
                    if (array_field.attr('type') == 'checkbox') {
                        array_field.prop('checked', false);
                        
                        if (value) {
                            array_field.parent().parent().find('label').removeClass('active');
                            var checkeds = JSON.parse(value);
                            $.each(checkeds, function(key, checkvalue) {
                                var check_input = array_field.filter('[value="'+checkvalue+'"]').prop('checked', true);
                                if (check_input.parent().prop('tagName') == 'LABEL') {
                                    check_input.parent().toggleClass('active');
                                }
                            });
                        }
                    }
                    else if (array_field.attr('component') == 'multientry') {
                        if (value) {
                            array_field.empty();
                            var values = JSON.parse(value);
                            $.each(values, function(key, value) {
                                array_field.append($("&lt;option/>").val(value).text(value));
                            });
                            array_field.val(values).trigger("change.select2");
                        }
                    }
                    else if (array_field.attr('component') == 'multisearch' &amp;&amp; array_field.attr('widget') !== 'tuniquesearch') {
                        if (value) {
                            var values = JSON.parse(value);
                            
                            var select2_template = function (d) {
                                if (/&lt;[a-z][\s\S]*>/i.test(d.text)) {
                                    return $("&lt;span>"+d.text+"&lt;/span>");
                                }
                                else {
                                    return d.text;
                                }
                            };
                            
                            // fi. sendData with multiple values for just one multisearch ['a','c']
                            if (array_field.attr('widget') == 'tmultisearch' || array_field.attr('widget') == 'tdbmultisearch')
                            {
                                array_field.select2({templateResult: select2_template, templateSelection: select2_template}).val(values).trigger('change.select2');
                            }
                            else // fi. sendData with multiple values for many uniques (inside fieldlist) ['a','c']
                            {
                                $.each(values, function(key, each_value) {
                                    var field_id = $($(array_field)[key]).attr('id');
                                    tform_send_data(form_name, '#'+field_id, each_value, fire_events);
                                } );
                                
                                // cancel fire events because it will be fired one by one inside the previous loop
                                fire_events = false;
                            }
                        }
                    }
                    else if (array_field.length) {
                        if (value) {
                            var values = JSON.parse(value);
                            $(array_field).find("option").prop('selected', false);
                            if (array_field.attr('widget') == 'tselect' &amp;&amp; array_field.length == 1) // single select[]
                            {
                                $.each(values, function(key, checkvalue) {
                                    $(array_field).find("option").filter('[value="'+checkvalue+'"]').prop('selected', true);
                                } );
                            }
                            else // array of inputs (tfieldlist)
                            {
                                $.each(values, function(key, each_value) {
                                    var field_id = $($(array_field)[key]).attr('id');
                                    tform_send_data(form_name, '#'+field_id, each_value, fire_events);
                                } );
                                
                                // cancel fire events because it will be fired one by one inside the previous loop
                                fire_events = false;
                            }
                        }
                    }
                    
                    if (fire_events) { 
                        if (array_field.attr('exitaction')) {
                            tform_events_hang_exec( array_field.attr('exitaction') );
                        }
                        if (array_field.attr('changeaction')) {
                            tform_events_hang_exec( array_field.attr('changeaction') );
                        }
                    }
                }
            }
            else {
                tform_events_queue_push( function(){
                    tform_send_data(form_name, field, value, fire_events);
                });
            }
        }
    } catch (e) {
        console.log(e);
    }
}

function tform_send_data_by_id(form_name, field, value, fire_events, timeout) {
    if (parseInt(timeout) > 0)
    {
        setTimeout( function() {
            tform_send_data_by_id(form_name, field, value, fire_events, 0);
        }, timeout);
        return;
    }

    try{
        if ($('form[name='+form_name+'] [id='+field+']').length) {
            if (typeof Adianti.formEventsCounter == 'undefined' || Number.isNaN(Adianti.formEventsCounter)) {
                Adianti.formEventsCounter = 0;
            }
            
            if (Adianti.formEventsCounter == 0 ) {
                $('form[name='+form_name+'] [id='+field+']').val( value );
                if (fire_events) { 
                    if ($('form[name='+form_name+'] [id='+field+']').attr('exitaction')) {
                        tform_events_hang_exec( $('form[name='+form_name+'] [id='+field+']').attr('exitaction') );
                    }
                    if ($('form[name='+form_name+'] [id='+field+']').attr('changeaction')) {
                        tform_events_hang_exec( $('form[name='+form_name+'] [id='+field+']').attr('changeaction') );
                    }
                }
            }
            else {
                tform_events_queue_push( function(){
                    tform_send_data_by_id(form_name, field, value, fire_events);
                });
            }
        }
    } catch (e) {
        console.log(e);
    }
}

function tform_events_hang_exec( string_callback )
{
    if (typeof Adianti.formEventsCounter == 'undefined' || Number.isNaN(Adianti.formEventsCounter)) {
        Adianti.formEventsCounter = 0;
    }
    
    Adianti.formEventsCounter ++;
    string_callback=string_callback.replace("'callback'", 'tform_decrease_events_counter');
    Function(string_callback)();
}

function tform_events_stop( callback )
{
    Adianti.formEventsStop = callback;
}

function tform_events_queue_push( callback )
{
    if (typeof Adianti.formEventsQueue == 'undefined')
    {
        Adianti.formEventsQueue = new Array;
    }
    Adianti.formEventsQueue.push( callback );
    setTimeout( tform_process_events_queue, 100 );
}

function tform_process_events_queue()
{
    if (typeof Adianti.formEventsCounter == 'undefined' || Number.isNaN(Adianti.formEventsCounter)) {
        Adianti.formEventsCounter = 0;
    }
    
    if (Adianti.formEventsCounter == 0 &amp;&amp; Adianti.formEventsQueue.length > 0)
    {
        next = Adianti.formEventsQueue.shift();
        next();
    }
    
    if (Adianti.formEventsQueue.length > 0)
    {
        setTimeout( tform_process_events_queue, 100 );
    }
    else
    {
        if (typeof Adianti.formEventsStop == 'function')
        {
            Adianti.formEventsStop();
            Adianti.formEventsStop = null;
        }
    }
}

function tform_decrease_events_counter()
{
    if (typeof Adianti.formEventsCounter == 'undefined' || Number.isNaN(Adianti.formEventsCounter)) {
        Adianti.formEventsCounter = 0;
    }
    
    Adianti.formEventsCounter --;
}

function tform_send_data_aggregate(form_name, field, value, fire_events) {
    try {
        if ($('form[name='+form_name+'] [name='+field+']').val() == '')
        {
            $('form[name='+form_name+'] [name='+field+']').val( value );
        }
        else
        {
            current_value = $('form[name='+form_name+'] [name='+field+']').val();
            $('form[name='+form_name+'] [name='+field+']').val( current_value + ', '+ value );
        }
    } catch (e) {
        console.log(e);
    }
}

function tform_fire_field_actions(form_name, field) { 
    if ($('form[name='+form_name+'] [name='+field+']').attr('exitaction')) {
        tform_events_hang_exec( $('form[name='+form_name+'] [name='+field+']').attr('exitaction') );
    }
    if ($('form[name='+form_name+'] [name='+field+']').attr('changeaction')) {
        tform_events_hang_exec( $('form[name='+form_name+'] [name='+field+']').attr('changeaction') );
    }
}

function tform_hide_field(form, field, speed) {
    if (typeof speed == 'undefined') {
        $('#'+form+' [name="'+field+'"]').closest('.tformrow').hide('fast');
    }
    else
    {
        $('#'+form+' [name="'+field+'"]').closest('.tformrow').hide(speed);
    }
}

function tform_show_field(form, field, speed) {
    if (typeof speed == 'undefined') {
        $('#'+form+' [name="'+field+'"]').closest('.tformrow').show('fast');
    }
    else
    {
        $('#'+form+' [name="'+field+'"]').closest('.tformrow').show(speed);
    }
}
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.2</a> on Mon Aug 21 2023 12:34:09 GMT-0300 (Horário Padrão de Brasília) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>



</body>
</html>
